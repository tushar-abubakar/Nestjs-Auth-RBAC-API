# ══════════════════════════════════════════════════════════════════════════════
# nest-auth-shield — Environment Variables Reference
# ══════════════════════════════════════════════════════════════════════════════
#
# 1. Copy this file:   cp .env.example .env
# 2. Fill in every value marked as REQUIRED.
# 3. Never commit your real .env to version control.
#
# Sections:
#   APP          — Server & runtime
#   DATABASE     — PostgreSQL connection
#   JWT          — Token secrets & lifetimes
#   CORS         — Cross-origin policy
#   MAIL         — SMTP / transactional email
#   FRONTEND     — Frontend base URL (magic links)
#   CACHE        — In-memory cache tuning
#   REDIS        — Redis connection (optional)
#   VERIFICATION — OTP rate-limiting
#   REGISTRATION — Sign-up rate-limiting
#   TWO_FACTOR   — TOTP 2FA settings
#   I18N         — Internationalisation
#
# ══════════════════════════════════════════════════════════════════════════════


# ─── APP ──────────────────────────────────────────────────────────────────────

# Human-readable name shown in emails and TOTP issuer label.
APP_NAME=NestAuthShield

# HTTP port the API server listens on.
PORT=3000

# Runtime environment. Controls logging verbosity and cache strategy.
# Allowed values: development | staging | production
NODE_ENV=development


# ─── DATABASE ─────────────────────────────────────────────────────────────────

# REQUIRED — Full PostgreSQL connection URL.
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public
DATABASE_URL=postgresql://postgres:password@localhost:5432/nest_auth_shield


# ─── JWT ──────────────────────────────────────────────────────────────────────

# REQUIRED — Signing secret used for ALL token types.
# Generate a strong secret: openssl rand -hex 64
JWT_SECRET=long_random_secret_min_64_chars

# Access token lifetime for a regular session (no "remember me").
# Uses ms-compatible strings: https://github.com/vercel/ms
JWT_EXPIRES_IN=15m

# Access token lifetime when the user checks "remember me".
JWT_REMEMBER_EXPIRES_IN=90d

# Refresh token lifetime for a regular session.
JWT_REFRESH_EXPIRES_IN=7d

# Refresh token lifetime for a remember-me session.
JWT_REFRESH_REMEMBER_EXPIRES_IN=60d

# Lifetime of short-lived challenge tokens:
#   EMAIL_VERIFICATION, TWO_FACTOR, PASSWORD_RESET, PASSWORD_RESET_VERIFICATION
JWT_2FA_EXPIRES_IN=10m


# ─── CORS ─────────────────────────────────────────────────────────────────────

# Allowed origin for cross-origin requests from the browser.
# Use the exact URL of your frontend (no trailing slash).
CORS_ORIGIN=http://localhost:8000


# ─── MAIL ─────────────────────────────────────────────────────────────────────
# Email is optional in development — the app logs a warning and continues.
# In production all four values (host, port, user, password) are REQUIRED.

# SMTP server hostname.
# Examples: smtp.gmail.com | smtp.sendgrid.net | smtp.mailgun.org
MAIL_HOST=smtp.example.com

# SMTP port.
#   465 → implicit SSL (SMTPS)
#   587 → STARTTLS (recommended)
MAIL_PORT=587

# SMTP login username (usually the sender email address).
MAIL_USER=no-reply@example.com

# SMTP login password or app-specific password.
MAIL_PASSWORD=your_smtp_password

# RFC-5321 From header shown to recipients.
# Format: "Display Name" <address@domain.com>
MAIL_FROM="NestAuthShield" <no-reply@example.com>


# ─── FRONTEND ─────────────────────────────────────────────────────────────────

# Base URL of your frontend app — used to build magic-link URLs in emails.
# No trailing slash.
FRONTEND_URL=http://localhost:8000


# ─── CACHE (IN-MEMORY) ────────────────────────────────────────────────────────

# Default TTL in seconds for in-memory cache entries.
CACHE_TTL=300

# Maximum number of entries held by the in-memory LRU cache.
CACHE_MAX_ITEMS=500


# ─── REDIS ────────────────────────────────────────────────────────────────────
# Redis is used as the primary cache in staging/production.
# When disabled or unreachable, the app falls back to in-memory cache.

# Set to true to enable Redis. Ignored in development (uses memory cache).
REDIS_ENABLED=false

# Full Redis connection URL.
# Formats:
#   redis://localhost:6379           (no auth)
#   redis://:password@localhost:6379 (password only)
#   rediss://user:pass@host:6380     (TLS — note the extra 's')
REDIS_URL=redis://localhost:6379


# ─── OTP / VERIFICATION EXPIRY ────────────────────────────────────────────────

# Minutes until an email-verification OTP expires.
EMAIL_VERIFICATION_EXPIRATION=30

# Minutes until a password-reset OTP expires.
FORGET_PASSWORD_EXPIRATION=30


# ─── VERIFICATION RATE-LIMITING ───────────────────────────────────────────────

# Maximum total (resend + verify) OTP attempts per user per day.
MAX_RESEND_ATTEMPTS=7

# Maximum OTP resend requests per user per day.
MAX_DAILY_RESEND_ATTEMPTS=7

# Maximum OTP verification attempts per user per day.
MAX_DAILY_VERIFY_ATTEMPTS=10


# ─── REGISTRATION RATE-LIMITING ───────────────────────────────────────────────

# Maximum new account sign-ups allowed per IP address per day.
MAX_DAILY_SIGNUPS=3


# ─── TWO-FACTOR AUTHENTICATION (TOTP) ────────────────────────────────────────

# Set to false to disable 2FA for the entire application.
TWO_FACTOR_ENABLED=true

# REQUIRED in production — TOTP issuer / secret label shown in authenticator apps.
# Generate a strong value: openssl rand -hex 32
TWO_FACTOR_SECRET=totp_secret

# How many backup codes are generated per user when 2FA is enabled.
TWO_FACTOR_BACKUP_CODES=10

# Milliseconds a user is locked out after exceeding the max failed 2FA attempts.
# Default: 900000 (15 minutes)
TWO_FACTOR_LOCKOUT_DURATION=900000


# ─── I18N ─────────────────────────────────────────────────────────────────────

# BCP-47 language tag used when no matching translation is found.
FALLBACK_LANGUAGE=en

# Comma-separated list of language tags the app supports.
AVAILABLE_LANGUAGES=en,es
